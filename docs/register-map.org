* Communication protocol

Communication is over I2C or UART (for UART you need to set a jumper).

- I2C address: *0x23*
- An I2C write operation consists of the I2C-address, the write flag, and 5 consecutive bytes.
- A UART write operation consists of 5 consecutive bytes.
- The two top/MSB bits of the first byte is the command address field.


** Register map

Variable values are explained in the table further down.

| Byte | Bit | Value       | Value    | Value      |
|------+-----+-------------+----------+------------|
|    0 |  39 | 0           | 1        | 1          |
|      |  38 | 1           | 1        | 0          |
|      |  37 | reserved      | reserved | reserved   |
|      |  36 | reserved | reserved | reserved   |
|      |  35 | reserved     | reserved | reserved   |
|      |  34 | tx          | reserved | reserved   |
|      |  33 | key         | reserved | reserved   |
|      |  32 | reserved          | reserved | reserved   |
|    1 |  31 | tx_att[1]      | reserved     | reserved   |
|      |  30 | tx_att[0]    | reserved     | reserved   |
|      |  29 | reserved    | reserved     | reserved   |
|      |  28 | rx_att[1]    | reserved     | reserved   |
|      |  27 | rx_att[0]    | reserved     | reserved   |
|      |  26 | reserved    | reserved     | reserved   |
|      |  25 | if_freq[2]    | reserved     | reserved   |
|      |  24 | if_freq[1]    | freq     | reserved   |
|    2 |  23 | if_freq[0]    | freq     | reserved   |
|      |  22 | reserved    | freq     | reserved   |
|      |  21 | reserved    | freq     | reserved   |
|      |  20 | reserved    | freq     | reserved   |
|      |  19 | reserved       | freq     | reserved   |
|      |  18 | reserved     | freq     | reserved   |
|      |  17 | reserved    | freq     | reserved   |
|      |  16 | reserved    | freq     | reserved   |
|    3 |  15 | reserved    | freq     | reserved   |
|      |  14 | reserved    | freq     | reserved   |
|      |  13 | reserved    | freq     | reserved	   |
|      |  12 | reserved    | freq     | reserved	   |
|      |  11 | reserved    | freq     | reserved	   |
|      |  10 | reserved    | freq     | reserved	   |
|      |   9 | reserved    | freq     | reserved	   |
|      |   8 | reserved    | freq     | reserved	   |
|    4 |   7 | reserved    | freq     | reserved   |
|      |   6 | reserved    | freq     | reserved   |
|      |   5 | reserved    | freq     | audio gain |
|      |   4 | reserved    | freq     | audio gain |
|      |   3 | reserved    | freq     | audio gain |
|      |   2 | reserved    | freq     | audio gain |
|      |   1 | reserved    | freq     | audio gain |
|      |   0 | reserved    | freq     | audio gain |



| Bit               | Value                                                                                             |
|-------------------+---------------------------------------------------------------------------------------------------|                                                 		|
| tx:               | 1: Forced TX, 0: RX or TX when PTT pin low                                                        |
| key:              | 1: Forced CW key, 0: Controlled by KEY pin                                                        |
| tx_att[1..0]:    | TX attenuation in steps of 6dB, 00: Full TX power                                                  |
| rx_att[1..0]:    | RX attenuation in steps of 6dB, 00: Full RX gain          														|
| if_freq[2..0:    | 001: IF=45MHz, 010: IF=21.4MHz         																				|
| freq[24..0]:      | Carrier frequency, in steps of 120e6/2^25 Hz                                                      |
| audio gain[5..0]: | Speaker audio attenuation, 011111 = mute, 000000 = 0dB, MSB always 0 (see TLV320AIC20K datasheet) |

Freq sets the frequency generated from DAC A in RX and both DACs in TX. Recommended range is 1-45 MHz.

~~In direct mode, the IF frequency is automatically compensated for in RX. That is, if the IF is set to 45 MHz and f is the frequency set, the frequency generated by DAC A will be f in TX and 45MHz-f in RX.
In the direct mode, the carrier at DAC A will be modulated in TX. In direct mode, DAC B will generate a constant carrier at fIF-312.5 kHz in RX. 

In indirect mode, the DAC A frequency can be used as a tunable reference for an external PLL synthesizer (like e.g. for 144 MHz operation) and the end/user frequency has to be calculated accordingly. It will be the same value both in RX and TX.
In indirect mode, DAC B will give a frequency at fIF-312.5 kHz in RX and a modulated carrier at fIF in TX.  

The clarifier value sets an offset for the frequency generated by DAC B, in RX mode only. It can be used for fine tuning of the RX frequency. If not needed simply write a value of null.~~

** Status byte
   
An I2C reading operation gives the status byte.													
Every fifth byte sent over UART results in the status byte being sent back.
Simply transmit [0x00 0x00 0x00 0x00 0x00] to read without altering any register.


| Bit nr |          |                                      |                                       
|--------+----------+--------------------------------------|
|      7 | TX/RX    | 1: TX, 0: RX â€“ For TX/RX indication  |
|      6 | N/A	    | 							                 |
|      5 | N/A     |                                       |
|      4 | N/A     | 												  |
|      3 | N/A     |                                       |
|      2 | N/A     |                                       |
|      1 | N/A     |                                       |
|      0 | N/A     |  				    							  |             


** I2S

LRCLK/FS is GPIO4, BCLK is GPIO5, DIN is GPIO3 and DOUT is GPIO6. 
39.0625 ksps. 32 bit mode for IQ out.
IQ is 2x24 bits padded with 8 LSB zeroes.
Audio fed to codec/speaker is 16 MSB's of left channel, sampled at DIN.
Note that I and Q are reversed if using LO above IF.
